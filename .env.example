# Variables de Entorno para CronoStudio

## Ubicación
Este archivo es un **template**. Copiar a `infra/docker/.env` y llenar con valores reales.

```bash
cp .env.example infra/docker/.env
```

**⚠️ NUNCA commitear `infra/docker/.env` a git si contiene credenciales reales.**

## PostgreSQL

```env
POSTGRES_USER=postgres
POSTGRES_PASSWORD=tu_password_seguro_aqui
POSTGRES_DB=cronostudio
POSTGRES_HOST=localhost
POSTGRES_PORT=5432
```

**Generador de password seguro:**
```bash
openssl rand -base64 32
```

## n8n

```env
N8N_USER_MANAGEMENT_DISABLED=false
N8N_ENCRYPTION_KEY=tu_encryption_key_aqui
N8N_WEBHOOK_TUNNEL_URL=http://localhost:5678/
N8N_EDITOR_BASE_URL=http://localhost:5678/
```

**Generador de N8N_ENCRYPTION_KEY:**
```bash
openssl rand -base64 32
```

Esto produce una key de 32 caracteres base64, segura para encriptar credenciales en n8n.

## Ejemplo Completo (Desarrollo Local)

```env
# PostgreSQL
POSTGRES_USER=postgres
POSTGRES_PASSWORD=dev_password_12345
POSTGRES_DB=cronostudio
POSTGRES_HOST=postgres
POSTGRES_PORT=5432

# n8n
N8N_USER_MANAGEMENT_DISABLED=false
N8N_ENCRYPTION_KEY=aBcDeFgHiJkLmNoPqRsTuVwXyZ0123456789==
N8N_WEBHOOK_TUNNEL_URL=http://localhost:5678/
N8N_EDITOR_BASE_URL=http://localhost:5678/
```

## Notas de Seguridad

- **En desarrollo local**: puedes usar passwords simples (ej: `postgres`, `password`)
- **En producción**: SIEMPRE usar passwords complejos de 32+ caracteres
- **N8N_ENCRYPTION_KEY**: debe ser diferente en cada ambiente
- **Archivos .env nunca en git**: agregar a `.gitignore` (ya está hecho)

## Cómo Usar

1. Copiar este archivo a `infra/docker/.env`:
   ```bash
   cp .env.example infra/docker/.env
   ```

2. Editar `infra/docker/.env` con un editor (NO versionar):
   ```bash
   vim infra/docker/.env
   # o
   nano infra/docker/.env
   ```

3. Levantar infraestructura:
   ```bash
   docker compose -f infra/docker/docker-compose.yml up -d
   ```

4. Verificar que los valores se leyeron:
   ```bash
   docker exec cronostudio-postgres psql -U postgres -c "SELECT 1;"
   ```

## Variables por Ambiente

### Desarrollo (local)
- `POSTGRES_PASSWORD=dev123` (simple)
- `N8N_ENCRYPTION_KEY=openssl rand -base64 32`

### Staging/Testing
- `POSTGRES_PASSWORD=$(openssl rand -base64 32)` (complejo)
- `N8N_USER_MANAGEMENT_DISABLED=true` (desactivar para testing)

### Producción
- `POSTGRES_PASSWORD=$(openssl rand -base64 32)` (obligatorio complejo)
- `N8N_USER_MANAGEMENT_DISABLED=false` (activar autenticación)
- Usar variables en hosting seguro (ej: AWS Secrets Manager, Vault)

## Referencia Docker Compose

El archivo `infra/docker/docker-compose.yml` lee variables de `.env`:

```yaml
services:
  postgres:
    env_file:
      - .env  # Lee POSTGRES_USER, POSTGRES_PASSWORD, etc
  n8n:
    env_file:
      - .env  # Lee N8N_*, POSTGRES_* para conectar a BD
```

## Troubleshooting

### "Error: password authentication failed for user "postgres""

Significa que `POSTGRES_PASSWORD` en `.env` no coincide con la que espera Postgres.

**Solución:**
1. Editar `infra/docker/.env`
2. Revisar `POSTGRES_PASSWORD`
3. Resetear volumen: `docker compose down -v && docker compose up -d`

### "n8n cannot connect to database"

**Verificar:**
- `POSTGRES_HOST=postgres` (nombre del container, no `localhost`)
- `POSTGRES_PORT=5432`
- `POSTGRES_USER` y `POSTGRES_PASSWORD` coinciden

### Variables no se cargan

Docker Compose carga `.env` automáticamente SI está en el directorio donde ejecutas `docker compose`.

**Verificar:**
```bash
pwd  # debe ser /Volumes/SSD-QVO/cronostudio/infra/docker
ls -la .env  # debe existir
```

## Lectura Adicional

- Docker Compose env files: https://docs.docker.com/compose/environment-variables/
- PostgreSQL environment vars: https://www.postgresql.org/docs/16/libpq-envars.html
- n8n configuration: https://docs.n8n.io/hosting/configuration/
